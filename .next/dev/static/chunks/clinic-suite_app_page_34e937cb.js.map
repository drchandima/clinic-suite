{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Education/WebDev%20with%20AI/Projects/clinic-suite/app/page.js"],"sourcesContent":["// app/pharmacy/page.js\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '../../components/AuthProvider';\nimport PharmacySidebar from '../../components/PharmacySidebar';\nimport PharmacyCenter from '../../components/PharmacyCenter';\nimport PharmacyQuickActions from '../../components/PharmacyQuickActions';\nimport { subscribePendingPrescriptions, subscribeDrugs } from '../../lib/firestoreClient';\n\nexport default function PharmacyPage() {\n  // --- hooks first ---\n  const { user, claims, loading } = useAuth();\n  const [prescriptions, setPrescriptions] = useState([]);\n  const [drugs, setDrugs] = useState([]);\n  const [selectedPrescription, setSelectedPrescription] = useState(null);\n  const [error, setError] = useState(null);\n\n  const clinicId = claims?.clinicId;\n\n  useEffect(() => {\n    if (loading || !clinicId) return;\n    setError(null);\n\n    const unsub1 = subscribePendingPrescriptions(\n      clinicId,\n      (items) => setPrescriptions(items),\n      (err) => setError(err?.message ?? String(err))\n    );\n\n    const unsub2 = subscribeDrugs(\n      clinicId,\n      (items) => setDrugs(items),\n      (err) => setError(err?.message ?? String(err))\n    );\n\n    return () => {\n      try { unsub1?.(); } catch(_) {}\n      try { unsub2?.(); } catch(_) {}\n    };\n  }, [loading, clinicId]);\n\n  // AUTH GUARD (after hooks)\n  if (loading) {\n    return (\n      <div className=\"min-h-[calc(100vh-56px)] flex items-center justify-center\">\n        <div className=\"text-sm text-slate-500\">Loading authentication...</div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"min-h-[calc(100vh-56px)] flex items-center justify-center\">\n        <div className=\"max-w-lg p-6 bg-white rounded-lg shadow\">\n          <h2 className=\"text-lg font-semibold\">Sign in required</h2>\n          <p className=\"mt-2 text-sm text-slate-600\">You must be signed in to access the Pharmacy area.</p>\n          <div className=\"mt-4 text-right\">\n            <a href=\"/login\" className=\"px-3 py-2 bg-indigo-600 text-white rounded\">Go to login</a>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!claims?.clinicId || !['pharmacist', 'admin'].includes(claims.role)) {\n    return <div className=\"p-10\">Access denied â€” pharmacist role required.</div>;\n  }\n\n  return (\n    <div className=\"min-h-[calc(100vh-56px)] bg-slate-50\">\n      <div className=\"max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-6\">\n        <aside className=\"lg:col-span-3\">\n          <PharmacySidebar\n            prescriptions={prescriptions}\n            selectedId={selectedPrescription?.id}\n            onSelect={(p) => setSelectedPrescription(p)}\n            selectedPrescription={selectedPrescription}  // <-- pass selected preview\n          />\n        </aside>\n\n        <main className=\"lg:col-span-6\">\n          <PharmacyCenter\n            clinicId={clinicId}\n            drugs={drugs}\n            prescription={selectedPrescription}\n            pharmacistEmail={user?.email}\n          />\n        </main>\n\n        <aside className=\"lg:col-span-3\">\n          <div className=\"sticky top-6\">\n            <PharmacyQuickActions clinicId={clinicId} />\n          </div>\n        </aside>\n      </div>\n\n      {error && (\n        <div className=\"max-w-7xl mx-auto p-4\">\n          <div className=\"bg-red-50 text-red-700 border border-red-200 p-3 rounded\">\n            {error}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;;AAGvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAFA;;;;;;;AASe,SAAS;;IACtB,sBAAsB;IACtB,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG;IAClC,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,4LAAQ,EAAC,EAAE;IACrD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,4LAAQ,EAAC,EAAE;IACrC,MAAM,CAAC,sBAAsB,wBAAwB,GAAG,IAAA,4LAAQ,EAAC;IACjE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,4LAAQ,EAAC;IAEnC,MAAM,WAAW,QAAQ;IAEzB,IAAA,6LAAS;kCAAC;YACR,IAAI,WAAW,CAAC,UAAU;YAC1B,SAAS;YAET,MAAM,SAAS,8BACb;iDACA,CAAC,QAAU,iBAAiB;;iDAC5B,CAAC,MAAQ,SAAS,KAAK,WAAW,OAAO;;YAG3C,MAAM,SAAS,eACb;iDACA,CAAC,QAAU,SAAS;;iDACpB,CAAC,MAAQ,SAAS,KAAK,WAAW,OAAO;;YAG3C;0CAAO;oBACL,IAAI;wBAAE;oBAAY,EAAE,OAAM,GAAG,CAAC;oBAC9B,IAAI;wBAAE;oBAAY,EAAE,OAAM,GAAG,CAAC;gBAChC;;QACF;iCAAG;QAAC;QAAS;KAAS;IAEtB,2BAA2B;IAC3B,IAAI,SAAS;QACX,qBACE,gNAAC;YAAI,WAAU;sBACb,cAAA,gNAAC;gBAAI,WAAU;0BAAyB;;;;;;;;;;;IAG9C;IAEA,IAAI,CAAC,MAAM;QACT,qBACE,gNAAC;YAAI,WAAU;sBACb,cAAA,gNAAC;gBAAI,WAAU;;kCACb,gNAAC;wBAAG,WAAU;kCAAwB;;;;;;kCACtC,gNAAC;wBAAE,WAAU;kCAA8B;;;;;;kCAC3C,gNAAC;wBAAI,WAAU;kCACb,cAAA,gNAAC;4BAAE,MAAK;4BAAS,WAAU;sCAA6C;;;;;;;;;;;;;;;;;;;;;;IAKlF;IAEA,IAAI,CAAC,QAAQ,YAAY,CAAC;QAAC;QAAc;KAAQ,CAAC,QAAQ,CAAC,OAAO,IAAI,GAAG;QACvE,qBAAO,gNAAC;YAAI,WAAU;sBAAO;;;;;;IAC/B;IAEA,qBACE,gNAAC;QAAI,WAAU;;0BACb,gNAAC;gBAAI,WAAU;;kCACb,gNAAC;wBAAM,WAAU;kCACf,cAAA,gNAAC;4BACC,eAAe;4BACf,YAAY,sBAAsB;4BAClC,UAAU,CAAC,IAAM,wBAAwB;4BACzC,sBAAsB;;;;;;;;;;;kCAI1B,gNAAC;wBAAK,WAAU;kCACd,cAAA,gNAAC;4BACC,UAAU;4BACV,OAAO;4BACP,cAAc;4BACd,iBAAiB,MAAM;;;;;;;;;;;kCAI3B,gNAAC;wBAAM,WAAU;kCACf,cAAA,gNAAC;4BAAI,WAAU;sCACb,cAAA,gNAAC;gCAAqB,UAAU;;;;;;;;;;;;;;;;;;;;;;YAKrC,uBACC,gNAAC;gBAAI,WAAU;0BACb,cAAA,gNAAC;oBAAI,WAAU;8BACZ;;;;;;;;;;;;;;;;;AAMb;GAhGwB;;QAEY;;;KAFZ"}}]
}